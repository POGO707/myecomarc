<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLACKPANTHER | Premium Gear</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              panther: {
                900: '#0f0f13',
                800: '#1a1a23',
                700: '#272735',
                accent: '#8b5cf6', // Violet/Purple accent
              }
            },
            animation: {
              'bounce-slow': 'bounce 3s infinite',
              'slide-up': 'slideUp 0.3s ease-out forwards',
              'slide-down': 'slideDown 0.3s ease-out forwards',
              'slide-left': 'slideLeft 0.3s ease-out forwards',
              'fade-in': 'fadeIn 0.5s ease-out forwards',
            },
            keyframes: {
              slideUp: {
                '0%': { transform: 'translateY(20px)', opacity: '0' },
                '100%': { transform: 'translateY(0)', opacity: '1' },
              },
              slideDown: {
                '0%': { transform: 'translateY(-20px)', opacity: '0' },
                '100%': { transform: 'translateY(0)', opacity: '1' },
              },
              slideLeft: {
                '0%': { transform: 'translateX(100%)' },
                '100%': { transform: 'translateX(0)' },
              },
              fadeIn: {
                '0%': { opacity: '0' },
                '100%': { opacity: '1' },
              }
            }
          }
        }
      }
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Import Map for Google GenAI -->
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.run/@google/genai",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0",
    "react-router-dom": "https://aistudiocdn.com/react-router-dom@^7.9.6"
  }
}
</script>

    <style>
      body {
        background-color: #0f0f13;
        color: #e2e8f0;
        font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      }
      /* Custom scrollbar */
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: #1a1a23; }
      ::-webkit-scrollbar-thumb { background: #4c1d95; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #6d28d9; }
      
      .hidden { display: none !important; }
      .modal-open { overflow: hidden; }

      /* Range Slider Styling */
      .range-slider {
        -webkit-appearance: none;
        width: 100%;
        height: 6px;
        background: #272735;
        border-radius: 5px;
        outline: none;
      }
      .range-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        background: #8b5cf6;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid #1a1a23;
        transition: transform 0.1s;
      }
      .range-slider::-webkit-slider-thumb:hover {
        transform: scale(1.1);
      }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navigation -->
    <nav class="sticky top-0 z-40 bg-panther-900/95 backdrop-blur-md border-b border-panther-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <!-- Logo -->
                <a href="#" class="flex items-center gap-2 group" data-link>
                    <div class="w-10 h-10 bg-panther-accent rounded-lg flex items-center justify-center transform group-hover:rotate-12 transition-transform duration-300 shadow-lg shadow-purple-500/20">
                        <span class="text-white font-black text-xl">B</span>
                    </div>
                    <h1 class="text-2xl font-bold tracking-tighter text-white uppercase hidden sm:block">BLACKPANTHER</h1>
                </a>

                <!-- Desktop Nav -->
                <div class="hidden md:flex items-center gap-8 mx-8">
                    <a href="#" class="font-medium hover:text-panther-accent transition-colors text-gray-400 nav-link" data-path="/">Home</a>
                    <a href="#/shop" class="font-medium hover:text-panther-accent transition-colors text-gray-400 nav-link" data-path="/shop">Shop All</a>
                </div>

                <!-- Search -->
                <div class="flex-1 max-w-md mx-4 hidden md:block group">
                    <div class="relative">
                        <input type="text" id="desktop-search" placeholder="Search gear..." class="w-full bg-panther-800 text-gray-200 pl-10 pr-4 py-2.5 rounded-full border border-panther-700 focus:outline-none focus:border-panther-accent focus:ring-1 focus:ring-panther-accent transition-all group-hover:border-gray-600">
                        <i data-lucide="search" class="absolute left-3 top-3 text-gray-500 w-4 h-4"></i>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex items-center gap-4">
                    <button class="relative p-2 text-gray-300 hover:text-white transition-colors hover:bg-panther-800 rounded-full" onclick="toggleCart()">
                        <i data-lucide="shopping-bag" class="w-6 h-6"></i>
                        <span id="cart-badge" class="hidden absolute top-0 right-0 inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-bold leading-none text-white transform translate-x-1/4 -translate-y-1/4 bg-panther-accent rounded-full border-2 border-panther-900">0</span>
                    </button>
                    <button class="md:hidden text-gray-300 hover:text-white" onclick="toggleMobileMenu()">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-panther-800 border-t border-panther-700">
            <div class="px-4 pt-4 pb-6 space-y-4">
                <div class="relative">
                    <input type="text" id="mobile-search" placeholder="Search gear..." class="w-full bg-panther-900 text-gray-200 pl-10 pr-4 py-3 rounded-lg border border-panther-700 focus:border-panther-accent outline-none">
                    <i data-lucide="search" class="absolute left-3 top-3.5 text-gray-500 w-4 h-4"></i>
                </div>
                <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-white hover:bg-panther-700">Home</a>
                <a href="#/shop" class="block px-3 py-2 rounded-md text-base font-medium text-white hover:bg-panther-700">Shop All Products</a>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <div id="app-content" class="flex-1 flex flex-col">
        <!-- Content injected via JS -->
    </div>

    <!-- Footer -->
    <footer class="bg-panther-900 border-t border-panther-700 py-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <h2 class="text-2xl font-bold text-white mb-4">BLACKPANTHER</h2>
            <div class="flex justify-center gap-6 mb-8 text-gray-400">
                <a href="#" class="hover:text-white">Home</a>
                <a href="#/shop" class="hover:text-white">Shop</a>
                <span class="cursor-pointer hover:text-white">Terms</span>
                <span class="cursor-pointer hover:text-white">Contact</span>
            </div>
            <p class="text-gray-500">&copy; <span id="year"></span> All rights reserved. <br> Dropshipping fulfillment by BLACKPANTHER Logistics.</p>
        </div>
    </footer>

    <!-- Cart Sidebar -->
    <div id="cart-sidebar" class="hidden fixed inset-0 z-50 flex justify-end">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="toggleCart()"></div>
        <div class="relative w-full max-w-md bg-panther-800 h-full shadow-2xl flex flex-col border-l border-panther-700 transform transition-transform duration-300 animate-slide-left">
            <div class="p-5 flex items-center justify-between border-b border-panther-700">
                <div class="flex items-center gap-2">
                    <i data-lucide="shopping-bag" class="text-panther-accent w-6 h-6"></i>
                    <h2 class="text-xl font-bold text-white">Your Cart</h2>
                </div>
                <button onclick="toggleCart()" class="text-gray-400 hover:text-white p-1 rounded-full hover:bg-panther-700 transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div id="cart-items" class="flex-1 overflow-y-auto p-5 space-y-4">
                <!-- Cart items injected here -->
            </div>
            <div id="cart-footer" class="p-5 border-t border-panther-700 bg-panther-800 hidden">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-gray-400">Total Amount</span>
                    <span class="text-2xl font-bold text-white">₹<span id="cart-total">0</span></span>
                </div>
                <button onclick="openCheckout()" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-green-500/20 transition-all active:scale-95">
                    Checkout Now
                </button>
                <p class="text-xs text-center text-gray-500 mt-3">Checkout via WhatsApp securely</p>
            </div>
            <div id="cart-empty-msg" class="hidden flex flex-col items-center justify-center h-64 text-gray-500">
                <i data-lucide="shopping-bag" class="w-12 h-12 mb-4 opacity-50"></i>
                <p>Your cart is empty.</p>
                <button onclick="toggleCart(); window.location.hash='#/shop'" class="mt-4 text-panther-accent hover:underline">Start Shopping</button>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="hidden fixed inset-0 z-50 flex items-end sm:items-center justify-center sm:p-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeCheckout()"></div>
        <div class="relative w-full sm:max-w-2xl bg-panther-800 rounded-t-2xl sm:rounded-2xl shadow-2xl border-t sm:border border-panther-700 overflow-hidden flex flex-col h-[90vh] sm:h-auto sm:max-h-[90vh]">
            
            <!-- Success View -->
            <div id="checkout-success" class="hidden p-8 md:p-12 flex flex-col items-center text-center animate-fade-in my-auto overflow-y-auto h-full justify-center">
                <div class="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mb-6 shrink-0">
                    <i data-lucide="check-circle" class="text-green-500 w-10 h-10"></i>
                </div>
                <h3 class="text-2xl font-bold text-white mb-2">Order Placed Successfully!</h3>
                <p class="text-gray-400 mb-6 max-w-md">
                    Thank you. Your order details have been saved and sent to our team.
                    <br/><br/>
                    <span class="text-yellow-400 text-sm">⚠️ If WhatsApp did not open automatically, please click the button below.</span>
                </p>
                <a id="wa-link-btn" href="#" target="_blank" class="bg-[#25D366] hover:bg-[#20bd5a] text-white font-bold py-3 px-8 rounded-full flex items-center gap-2 mb-4 shadow-lg hover:shadow-green-500/20 transition-all">
                    <i data-lucide="message-circle" class="w-5 h-5"></i>
                    Send Order Details on WhatsApp
                </a>
                <button onclick="closeCheckout()" class="text-gray-400 hover:text-white text-sm hover:underline">Close and Continue Shopping</button>
            </div>

            <!-- Form View -->
            <form id="checkout-form" onsubmit="handlePlaceOrder(event)" class="flex flex-col h-full overflow-hidden">
                <div class="shrink-0 p-4 border-b border-panther-700 flex justify-between items-center bg-panther-900 z-10">
                    <div class="flex items-center gap-2">
                        <i data-lucide="map-pin" class="text-panther-accent w-6 h-6"></i>
                        <h2 class="text-xl font-bold text-white">Delivery Details</h2>
                    </div>
                    <button type="button" onclick="closeCheckout()" class="text-gray-400 hover:text-white">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto p-4 space-y-6 min-h-0 scrollbar-thin scrollbar-thumb-panther-accent scrollbar-track-panther-900">
                    <div class="space-y-3">
                        <h3 class="text-gray-400 text-xs font-bold uppercase tracking-wider">Contact Information</h3>
                        <div class="grid grid-cols-1 gap-3">
                            <input required name="fullName" type="text" class="w-full bg-panther-900 border border-panther-700 rounded-lg p-3 text-white focus:border-panther-accent focus:outline-none placeholder-gray-500 text-sm" placeholder="Full Name (Required)">
                            <input required name="phone" type="tel" pattern="[0-9]{10}" maxlength="10" class="w-full bg-panther-900 border border-panther-700 rounded-lg p-3 text-white focus:border-panther-accent focus:outline-none placeholder-gray-500 text-sm" placeholder="Phone Number (10 digits)">
                        </div>
                    </div>

                    <div class="space-y-3">
                        <h3 class="text-gray-400 text-xs font-bold uppercase tracking-wider">Shipping Address</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <input required name="pincode" type="text" pattern="[0-9]{6}" maxlength="6" class="w-full bg-panther-900 border border-panther-700 rounded-lg p-3 text-white focus:border-panther-accent focus:outline-none placeholder-gray-500 text-sm" placeholder="Pincode">
                            <input required name="state" type="text" class="w-full bg-panther-900 border border-panther-700 rounded-lg p-3 text-white focus:border-panther-accent focus:outline-none placeholder-gray-500 text-sm" placeholder="State">
                            <input required name="city" type="text" class="w-full bg-panther-900 border border-panther-700 rounded-lg p-3 text-white focus:border-panther-accent focus:outline-none placeholder-gray-500 text-sm" placeholder="City/District">
                            <input required name="locality" type="text" class="w-full bg-panther-900 border border-panther-700 rounded-lg p-3 text-white focus:border-panther-accent focus:outline-none placeholder-gray-500 text-sm" placeholder="Locality">
                        </div>
                        <input required name="houseNo" type="text" class="w-full bg-panther-900 border border-panther-700 rounded-lg p-3 text-white focus:border-panther-accent focus:outline-none placeholder-gray-500 text-sm" placeholder="Flat, House no., Building, Apt">
                        <input required name="area" type="text" class="w-full bg-panther-900 border border-panther-700 rounded-lg p-3 text-white focus:border-panther-accent focus:outline-none placeholder-gray-500 text-sm" placeholder="Area, Street, Sector, Village">
                    </div>

                    <div class="space-y-3">
                        <h3 class="text-gray-400 text-xs font-bold uppercase tracking-wider">Payment Method</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <button type="button" onclick="setPaymentMethod('cod')" id="btn-cod" class="flex flex-col items-center justify-center p-3 rounded-xl border transition-all bg-panther-accent/10 border-panther-accent text-white">
                                <i data-lucide="banknote" class="w-5 h-5 mb-1"></i>
                                <span class="font-bold text-xs">Cash on Delivery</span>
                            </button>
                            <button type="button" onclick="setPaymentMethod('online')" id="btn-online" class="flex flex-col items-center justify-center p-3 rounded-xl border transition-all bg-panther-900 border-panther-700 text-gray-400 hover:border-gray-500">
                                <i data-lucide="qr-code" class="w-5 h-5 mb-1"></i>
                                <span class="font-bold text-xs">Pay Online (QR)</span>
                            </button>
                        </div>
                    </div>

                    <div id="payment-online-section" class="hidden bg-white p-4 rounded-xl flex-col items-center border-2 border-panther-accent/50 relative overflow-hidden shadow-xl">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"></div>
                        <h4 class="text-panther-900 font-extrabold text-base mb-3 text-center">Scan & Pay via UPI</h4>
                        <div class="p-2 bg-white rounded-xl shadow-lg border border-gray-100 mb-3">
                            <img id="qr-image" src="" alt="Payment QR Code" class="w-40 h-40 rounded-lg">
                        </div>
                        <div class="flex items-center gap-2 bg-gray-100 px-3 py-2 rounded-lg mb-2 w-full max-w-xs justify-between border border-gray-200">
                            <span class="text-xs font-mono text-gray-700 font-bold truncate select-all">hmoinuddin84@oksbi</span>
                            <button type="button" onclick="copyUPI()" class="text-panther-accent hover:text-purple-700 p-1 transition-colors flex items-center justify-center">
                                <i data-lucide="copy" class="w-3.5 h-3.5"></i>
                            </button>
                        </div>
                        <div class="text-xs text-gray-500 text-center max-w-xs space-y-1">
                            <p>Accepted: GPay, PhonePe, Paytm</p>
                        </div>
                    </div>

                    <div id="payment-cod-section" class="bg-panther-900 p-4 rounded-lg border border-panther-700 flex justify-between items-center">
                        <span class="text-gray-300 font-medium">Total Payable</span>
                        <span class="text-xl font-bold text-panther-accent">₹<span class="checkout-total">0</span></span>
                    </div>

                    <div class="h-4"></div>
                </div>

                <div class="shrink-0 p-4 border-t border-panther-700 bg-panther-800 z-10">
                    <button type="submit" id="submit-btn" class="w-full bg-panther-accent hover:bg-purple-600 disabled:opacity-50 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-all shadow-lg hover:shadow-purple-500/20">
                        <i data-lucide="send" class="w-4.5 h-4.5"></i>
                        <span>Confirm & Place Order</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- AI Assistant -->
    <div id="ai-widget">
        <button onclick="toggleAI()" id="ai-toggle" class="fixed bottom-6 right-6 bg-panther-accent hover:bg-purple-600 text-white p-4 rounded-full shadow-lg hover:shadow-purple-500/30 transition-all z-40 animate-bounce-slow">
            <i data-lucide="sparkles" class="w-6 h-6"></i>
        </button>

        <div id="ai-window" class="hidden fixed bottom-6 right-6 w-80 sm:w-96 bg-panther-800 border border-panther-700 rounded-2xl shadow-2xl z-50 flex flex-col overflow-hidden animate-slide-up h-[500px]">
            <div class="bg-panther-accent p-4 flex justify-between items-center">
                <div class="flex items-center gap-2 text-white">
                    <i data-lucide="sparkles" class="w-5 h-5"></i>
                    <h3 class="font-bold">PantherBot AI</h3>
                </div>
                <button onclick="toggleAI()" class="text-white/80 hover:text-white transition-colors">
                    <i data-lucide="minimize-2" class="w-4.5 h-4.5"></i>
                </button>
            </div>
            <div id="ai-messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-panther-900/50">
                <div class="flex justify-start">
                    <div class="max-w-[80%] p-3 rounded-lg text-sm bg-panther-700 text-gray-200 rounded-bl-none">
                        Hello! I'm PantherBot. Looking for something specific or need a gift idea?
                    </div>
                </div>
            </div>
            <div class="p-3 bg-panther-800 border-t border-panther-700 flex gap-2">
                <input type="text" id="ai-input" placeholder="Ask me anything..." class="flex-1 bg-panther-900 text-white text-sm rounded-lg px-4 py-2 border border-panther-700 focus:outline-none focus:border-panther-accent" onkeydown="if(event.key === 'Enter') sendAIMessage()">
                <button onclick="sendAIMessage()" class="bg-panther-accent text-white p-2 rounded-lg hover:bg-purple-600 transition-colors">
                    <i data-lucide="send" class="w-4.5 h-4.5"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Application Script -->
    <script type="module">
        import { GoogleGenAI } from "@google/genai";

        // --- CONSTANTS ---
        const STORE_NAME = "BLACKPANTHER";
        const WHATSAPP_NUMBER = "916289204920";
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz_XXXXXXXX_REPLACE_THIS_WITH_YOUR_REAL_URL/exec";
        const UPI_ID = "hmoinuddin84@oksbi";
        
        // --- DATA ---
        const PRODUCTS = [
            { id: '1', name: 'Stealth Smartwatch Ultra', price: 2999, category: 'Electronics', image: 'https://picsum.photos/400/400?random=1', description: 'Military grade durability, 30-day battery life, complete health tracking.' },
            { id: '2', name: 'Panther Bass Earbuds', price: 1499, category: 'Audio', image: 'https://picsum.photos/400/400?random=2', description: 'Active noise cancelling, deep bass profile, waterproof casing.' },
            { id: '3', name: 'Vibranium Tech Hoodie', price: 1999, category: 'Apparel', image: 'https://picsum.photos/400/400?random=3', description: 'Premium cotton blend, water-resistant coating, hidden tech pockets.' },
            { id: '4', name: 'Night Vision Glasses', price: 899, category: 'Accessories', image: 'https://picsum.photos/400/400?random=4', description: 'Anti-glare, blue light filtering, sleek matte black frame.' },
            { id: '5', name: 'Tactical Backpack', price: 2499, category: 'Travel', image: 'https://picsum.photos/400/400?random=5', description: '40L capacity, modular MOLLE system, laptop compartment.' },
            { id: '6', name: 'Shadow Gaming Mouse', price: 1299, category: 'Gaming', image: 'https://picsum.photos/400/400?random=6', description: 'RGB lighting, 16000 DPI sensor, programmable macro buttons.' }
        ];

        // --- STATE ---
        let cart = [];
        let currentPaymentMethod = 'cod';
        let aiHistory = [{ role: 'model', parts: [{ text: "Hello! I'm PantherBot. Looking for something specific or need a gift idea?" }] }];
        
        // Shop Filter State
        let shopState = {
            category: 'All',
            maxPrice: 10000,
            sort: 'featured',
            search: ''
        };

        // --- INITIALIZATION ---
        document.getElementById('year').textContent = new Date().getFullYear();
        window.addEventListener('hashchange', renderRouter);
        
        // Expose functions globally for onclick handlers
        window.toggleCart = toggleCart;
        window.toggleMobileMenu = toggleMobileMenu;
        window.addToCart = addToCart;
        window.removeFromCart = removeFromCart;
        window.updateQuantity = updateQuantity;
        window.openCheckout = openCheckout;
        window.closeCheckout = closeCheckout;
        window.setPaymentMethod = setPaymentMethod;
        window.copyUPI = copyUPI;
        window.handlePlaceOrder = handlePlaceOrder;
        window.toggleAI = toggleAI;
        window.sendAIMessage = sendAIMessage;
        // Shop Exposes
        window.toggleFilters = toggleFilters;
        window.updateShopState = updateShopState;
        // Share Expose
        window.shareProduct = shareProduct;

        // Search Listeners
        ['desktop-search', 'mobile-search'].forEach(id => {
            const el = document.getElementById(id);
            if(el) {
                el.addEventListener('input', (e) => {
                    if (window.location.hash !== '#/shop') window.location.hash = '#/shop';
                    renderShop(e.target.value);
                });
            }
        });

        // Initial Render
        renderRouter();
        lucide.createIcons();

        // --- ROUTING ---
        function renderRouter() {
            const hash = window.location.hash || '#/';
            const contentDiv = document.getElementById('app-content');
            window.scrollTo(0,0);

            // Hide/Reset sidebar if leaving shop (optional, currently we rebuild shop on entry)
            if (!hash.startsWith('#/shop')) {
               const sidebar = document.getElementById('shop-sidebar');
               if (sidebar) sidebar.remove();
            }

            if (hash === '#/' || hash === '') {
                renderHome(contentDiv);
            } else if (hash.startsWith('#/shop')) {
                // If coming from another page, full render. If just hash change due to internal logic (unlikely), full render.
                renderShop(null, contentDiv);
            } else if (hash.startsWith('#/product/')) {
                const id = hash.split('/')[2];
                renderProductDetail(id, contentDiv);
            }
            
            // Update nav active state
            document.querySelectorAll('.nav-link').forEach(link => {
                const path = link.getAttribute('data-path');
                if ((hash === '#/' && path === '/') || (hash.includes(path) && path !== '/')) {
                    link.classList.add('text-white');
                    link.classList.remove('text-gray-400');
                } else {
                    link.classList.remove('text-white');
                    link.classList.add('text-gray-400');
                }
            });
            lucide.createIcons();
        }

        // --- RENDERERS ---
        
        function renderHome(container) {
            const featured = PRODUCTS.slice(0, 3).map(p => createProductCardHTML(p)).join('');
            
            container.innerHTML = `
                <div class="relative bg-panther-800 overflow-hidden">
                    <div class="absolute inset-0">
                        <img src="https://picsum.photos/1920/600?grayscale" class="w-full h-full object-cover opacity-20" alt="Hero">
                        <div class="absolute inset-0 bg-gradient-to-t from-panther-900 to-transparent"></div>
                    </div>
                    <div class="relative max-w-7xl mx-auto py-32 px-4 sm:px-6 lg:px-8 text-center z-10">
                         <div class="inline-flex items-center gap-2 bg-panther-accent/20 border border-panther-accent/40 rounded-full px-4 py-1.5 mb-8 backdrop-blur-sm">
                            <span class="w-2 h-2 rounded-full bg-panther-accent animate-pulse"></span>
                            <span class="text-panther-accent text-sm font-bold tracking-wide uppercase">New Collection Drop</span>
                        </div>
                        <h1 class="text-5xl md:text-7xl font-black text-white tracking-tighter mb-6 leading-tight">
                            UNLEASH YOUR <br/> <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-panther-accent">INNER POWER</span>
                        </h1>
                         <p class="mt-6 text-xl text-gray-300 max-w-2xl mx-auto font-light leading-relaxed">
                            Premium gear delivered directly to your doorstep. Verified quality. Secure payments via WhatsApp.
                        </p>
                        <div class="mt-10 flex justify-center gap-4">
                            <a href="#/shop" class="bg-white text-panther-900 hover:bg-gray-200 font-bold py-4 px-8 rounded-xl shadow-xl hover:scale-105 transition-all duration-300 flex items-center gap-2">
                                Shop Collection <i data-lucide="arrow-right" class="w-5 h-5"></i>
                            </a>
                        </div>
                    </div>
                </div>
                <main class="flex-1 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 w-full">
                    <div class="flex items-center justify-between mb-12">
                        <div class="flex items-center gap-3">
                            <div class="bg-panther-accent p-2 rounded-lg"><i data-lucide="zap" class="text-white w-6 h-6"></i></div>
                            <h2 class="text-3xl font-bold text-white">Trending Gear</h2>
                        </div>
                        <a href="#/shop" class="hidden sm:flex items-center gap-2 text-panther-accent font-semibold hover:text-white transition-colors">View All <i data-lucide="arrow-right" class="w-4 h-4"></i></a>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                        ${featured}
                    </div>
                     <div class="mt-12 text-center">
                        <a href="#/shop" class="inline-block bg-panther-800 hover:bg-panther-700 text-white font-bold py-3 px-12 rounded-xl border border-panther-700 hover:border-panther-accent transition-all shadow-lg hover:shadow-purple-500/20">View All Products</a>
                    </div>
                </main>
                <div class="bg-panther-800 border-y border-panther-700 py-16">
                     <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                        <div class="p-6">
                            <h3 class="text-white text-xl font-bold mb-2">Premium Quality</h3>
                            <p class="text-gray-400">Hand-picked gear.</p>
                        </div>
                        <div class="p-6 md:border-l border-panther-700">
                             <h3 class="text-white text-xl font-bold mb-2">Fast Shipping</h3>
                            <p class="text-gray-400">Express delivery.</p>
                        </div>
                        <div class="p-6 md:border-l border-panther-700">
                             <h3 class="text-white text-xl font-bold mb-2">Secure Support</h3>
                            <p class="text-gray-400">24/7 via WhatsApp.</p>
                        </div>
                     </div>
                </div>
            `;
        }

        // --- SHOP & FILTERS ---

        function toggleFilters() {
            const sidebar = document.getElementById('shop-sidebar');
            if(sidebar) {
                sidebar.classList.toggle('hidden');
                sidebar.classList.toggle('fixed');
                sidebar.classList.toggle('inset-0');
                sidebar.classList.toggle('z-50');
            }
        }

        function updateShopState(key, value) {
            shopState[key] = value;
            renderShop();
        }

        function getFilteredProducts() {
             let result = PRODUCTS.filter(p => {
                const term = shopState.search.toLowerCase();
                const matchesSearch = (p.name.toLowerCase().includes(term) || 
                                     p.category.toLowerCase().includes(term));
                const matchesCategory = shopState.category === 'All' || p.category === shopState.category;
                const matchesPrice = p.price <= shopState.maxPrice;
                return matchesSearch && matchesCategory && matchesPrice;
            });

            // Sort
            switch(shopState.sort) {
                case 'price-asc': result.sort((a,b) => a.price - b.price); break;
                case 'price-desc': result.sort((a,b) => b.price - a.price); break;
                case 'name-asc': result.sort((a,b) => a.name.localeCompare(b.name)); break;
                case 'name-desc': result.sort((a,b) => b.name.localeCompare(a.name)); break;
                case 'popularity': result.sort((a,b) => 0.5 - Math.random()); break; // Simulating popularity
            }
            return result;
        }

        function renderShop(searchTerm = null, container) {
            // 1. Update Search State if passed (from Nav)
            if (searchTerm !== null) {
                shopState.search = searchTerm;
                // Sync internal input if exists
                const internalInput = document.getElementById('shop-search-input');
                if (internalInput) internalInput.value = searchTerm;
            }

            // 2. Filter Data
            const products = getFilteredProducts();

            // 3. Determine Render Mode
            const gridEl = document.getElementById('shop-grid');
            const isPartialUpdate = !container && gridEl;

            if (isPartialUpdate) {
                // Partial Update
                gridEl.innerHTML = products.length ? 
                    `<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in">${products.map(p => createProductCardHTML(p)).join('')}</div>` : 
                    `<div class="flex flex-col items-center justify-center py-24 text-center bg-panther-800/50 rounded-2xl border border-panther-700 border-dashed">
                         <i data-lucide="filter" class="text-gray-600 mb-4 w-12 h-12"></i>
                         <p class="text-gray-400 text-xl font-medium mb-2">No products match your filters.</p>
                       </div>`;
                
                document.getElementById('shop-count').textContent = `${products.length} Items`;
                document.getElementById('mobile-count').textContent = `${products.length} Items`;
                document.getElementById('price-val').textContent = shopState.maxPrice;
                lucide.createIcons();
                return;
            }

            // Full Render
            const el = container || document.getElementById('app-content');
            const categories = ['All', ...new Set(PRODUCTS.map(p => p.category))];
            const maxPriceLimit = Math.max(...PRODUCTS.map(p => p.price)) + 500;
            if(shopState.maxPrice === 10000) shopState.maxPrice = maxPriceLimit; // Reset/Init max

            el.innerHTML = `
                <main class="flex-1 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
                    <div class="flex flex-col lg:flex-row gap-8">
                        <!-- Mobile Filter Toggle -->
                        <div class="lg:hidden flex justify-between items-center mb-4">
                            <button onclick="toggleFilters()" class="flex items-center gap-2 bg-panther-800 text-white px-4 py-2 rounded-lg border border-panther-700">
                                <i data-lucide="sliders-horizontal" class="w-4 h-4"></i> Filters
                            </button>
                            <span id="mobile-count" class="text-gray-400 text-sm">${products.length} Items</span>
                        </div>

                        <!-- Sidebar -->
                        <aside id="shop-sidebar" class="hidden lg:block fixed inset-0 bg-panther-900 lg:static lg:bg-transparent lg:z-auto lg:w-64">
                            <div class="h-full overflow-y-auto p-5 lg:p-0">
                                <div class="flex justify-between items-center lg:hidden mb-6">
                                    <h2 class="text-xl font-bold text-white">Filters</h2>
                                    <button onclick="toggleFilters()" class="text-gray-400"><i data-lucide="x" class="w-6 h-6"></i></button>
                                </div>
                                
                                <div class="space-y-8">
                                    <!-- Search -->
                                    <div>
                                        <h3 class="text-white font-bold mb-4">Search</h3>
                                        <div class="relative">
                                            <input type="text" id="shop-search-input" value="${shopState.search}" oninput="updateShopState('search', this.value)" placeholder="Search products..." class="w-full bg-panther-800 border border-panther-700 rounded-lg py-2 pl-3 pr-10 text-white focus:border-panther-accent outline-none">
                                            <i data-lucide="search" class="absolute right-3 top-2.5 text-gray-500 w-4 h-4"></i>
                                        </div>
                                    </div>

                                    <!-- Categories -->
                                    <div>
                                        <h3 class="text-white font-bold mb-4">Category</h3>
                                        <div class="space-y-2">
                                            ${categories.map(cat => `
                                                <label class="flex items-center gap-3 cursor-pointer group">
                                                    <div class="w-5 h-5 rounded border flex items-center justify-center transition-colors ${shopState.category === cat ? 'bg-panther-accent border-panther-accent' : 'border-gray-600 group-hover:border-gray-400'}">
                                                        ${shopState.category === cat ? '<div class="w-2 h-2 bg-white rounded-full"></div>' : ''}
                                                    </div>
                                                    <input type="radio" name="category" value="${cat}" ${shopState.category === cat ? 'checked' : ''} onchange="updateShopState('category', '${cat}')" class="hidden">
                                                    <span class="text-sm ${shopState.category === cat ? 'text-white' : 'text-gray-400 group-hover:text-gray-300'}">${cat}</span>
                                                </label>
                                            `).join('')}
                                        </div>
                                    </div>

                                    <!-- Price Slider -->
                                    <div>
                                        <div class="flex justify-between mb-2">
                                            <h3 class="text-white font-bold">Max Price</h3>
                                            <span class="text-panther-accent font-bold">₹<span id="price-val">${shopState.maxPrice}</span></span>
                                        </div>
                                        <input type="range" min="0" max="${maxPriceLimit}" value="${shopState.maxPrice}" oninput="updateShopState('maxPrice', this.value)" class="range-slider">
                                    </div>
                                    
                                    <button onclick="toggleFilters()" class="w-full mt-8 bg-panther-accent text-white font-bold py-3 rounded-lg lg:hidden">
                                        View Results
                                    </button>
                                </div>
                            </div>
                        </aside>

                        <!-- Grid -->
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-white hidden lg:block">
                                    ${shopState.category === 'All' ? 'All Products' : shopState.category}
                                </h2>
                                <div class="flex items-center gap-4 ml-auto">
                                    <span id="shop-count" class="hidden lg:inline text-gray-400 text-sm">${products.length} Items</span>
                                    <div class="relative">
                                        <select onchange="updateShopState('sort', this.value)" class="appearance-none bg-panther-800 text-white pl-4 pr-10 py-2 rounded-lg border border-panther-700 cursor-pointer focus:border-panther-accent outline-none">
                                            <option value="featured" ${shopState.sort === 'featured' ? 'selected' : ''}>Featured</option>
                                            <option value="popularity" ${shopState.sort === 'popularity' ? 'selected' : ''}>Popularity</option>
                                            <option value="price-asc" ${shopState.sort === 'price-asc' ? 'selected' : ''}>Price: Low to High</option>
                                            <option value="price-desc" ${shopState.sort === 'price-desc' ? 'selected' : ''}>Price: High to Low</option>
                                            <option value="name-asc" ${shopState.sort === 'name-asc' ? 'selected' : ''}>Name: A - Z</option>
                                            <option value="name-desc" ${shopState.sort === 'name-desc' ? 'selected' : ''}>Name: Z - A</option>
                                        </select>
                                        <i data-lucide="chevron-down" class="absolute right-3 top-3 text-gray-400 pointer-events-none w-4 h-4"></i>
                                    </div>
                                </div>
                            </div>

                            <div id="shop-grid">
                                ${products.length ? 
                                    `<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in">${products.map(p => createProductCardHTML(p)).join('')}</div>` : 
                                    `<div class="flex flex-col items-center justify-center py-24 text-center bg-panther-800/50 rounded-2xl border border-panther-700 border-dashed">
                                         <i data-lucide="filter" class="text-gray-600 mb-4 w-12 h-12"></i>
                                         <p class="text-gray-400 text-xl font-medium mb-2">No products match your filters.</p>
                                       </div>`
                                }
                            </div>
                        </div>
                    </div>
                </main>
            `;
            lucide.createIcons();
        }

        function renderProductDetail(id, container) {
            const product = PRODUCTS.find(p => p.id === id);
            if (!product) {
                container.innerHTML = `<div class="flex-1 flex flex-col items-center justify-center p-8 text-center"><h2 class="text-3xl font-bold text-white mb-4">Product Not Found</h2><a href="#/" class="text-panther-accent hover:underline">Return Home</a></div>`;
                return;
            }

            container.innerHTML = `
                <div class="flex-1 bg-panther-900">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
                        <button onclick="history.back()" class="flex items-center text-gray-400 hover:text-white mb-8 transition-colors">
                            <i data-lucide="arrow-left" class="w-5 h-5 mr-2"></i> Back
                        </button>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                            <div class="relative rounded-2xl overflow-hidden bg-panther-800 border border-panther-700 shadow-2xl">
                                <img src="${product.image}" class="w-full h-full object-cover min-h-[400px] lg:min-h-[600px]">
                                <span class="absolute top-4 left-4 bg-panther-accent text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">${product.category}</span>
                            </div>
                            <div class="flex flex-col justify-center">
                                <h1 class="text-4xl md:text-5xl font-extrabold text-white mb-4">${product.name}</h1>
                                <div class="flex items-center gap-4 mb-6">
                                    <span class="text-3xl font-bold text-panther-accent">₹${product.price}</span>
                                    <div class="flex items-center gap-1 text-yellow-500">
                                        <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                        <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                        <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                        <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                        <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                    </div>
                                </div>
                                <p class="text-gray-300 text-lg leading-relaxed mb-8">${product.description}</p>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8">
                                    <div class="flex items-center gap-3 text-gray-300"><div class="bg-panther-800 p-2 rounded-lg text-panther-accent"><i data-lucide="shield" class="w-5 h-5"></i></div> <span class="text-sm">1 Year Warranty</span></div>
                                    <div class="flex items-center gap-3 text-gray-300"><div class="bg-panther-800 p-2 rounded-lg text-panther-accent"><i data-lucide="truck" class="w-5 h-5"></i></div> <span class="text-sm">Free Express Shipping</span></div>
                                </div>
                                <button onclick="addToCart('${product.id}')" class="bg-panther-accent hover:bg-purple-600 text-white font-bold py-4 px-8 rounded-xl shadow-lg flex items-center justify-center gap-3 transition-all active:scale-95">
                                    <i data-lucide="shopping-bag" class="w-6 h-6"></i> Add to Cart
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createProductCardHTML(product) {
            return `
                <div class="bg-panther-800 rounded-xl overflow-hidden shadow-lg border border-panther-700 hover:border-panther-accent transition-all duration-300 group flex flex-col h-full">
                    <div class="relative h-64 overflow-hidden shrink-0">
                        <a href="#/product/${product.id}" class="block h-full w-full cursor-pointer">
                            <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover transform transition-transform duration-700 ease-out group-hover:scale-110">
                            <div class="absolute inset-0 bg-gradient-to-t from-panther-900 via-transparent to-transparent opacity-60 transition-opacity"></div>
                        </a>
                        <div class="absolute bottom-4 left-4 pointer-events-none">
                            <span class="bg-panther-accent text-white text-xs font-bold px-2 py-1 rounded-full uppercase tracking-wider shadow-lg">${product.category}</span>
                        </div>
                        <button onclick="shareProduct('${product.id}', event)" class="absolute top-4 right-4 bg-panther-900/80 p-2.5 rounded-full text-white backdrop-blur-md border border-panther-700 hover:border-panther-accent hover:bg-panther-accent transition-all shadow-xl z-10 hover:scale-110 active:scale-95" title="Share Product">
                            <i data-lucide="share-2" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="p-5 flex flex-col flex-1">
                        <div class="flex justify-between items-start mb-2">
                            <a href="#/product/${product.id}" class="hover:text-panther-accent transition-colors">
                                <h3 class="text-xl font-bold text-white leading-tight">${product.name}</h3>
                            </a>
                            <span class="text-panther-accent font-bold text-lg">₹${product.price}</span>
                        </div>
                        <p class="text-gray-400 text-sm mb-4 line-clamp-2 flex-1">${product.description}</p>
                        <div class="grid grid-cols-2 gap-3 mt-auto">
                            <a href="#/product/${product.id}" class="flex items-center justify-center gap-2 bg-panther-900 hover:bg-panther-700 text-white font-semibold py-3 px-4 rounded-lg border border-panther-700 transition-colors">
                                <i data-lucide="eye" class="w-4 h-4"></i> View
                            </a>
                            <button onclick="addToCart('${product.id}')" class="flex items-center justify-center gap-2 bg-panther-700 hover:bg-panther-accent text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 active:scale-95">
                                <i data-lucide="shopping-bag" class="w-4 h-4"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        async function shareProduct(id, e) {
            if(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            const product = PRODUCTS.find(p => p.id === id);
            if(!product) return;

            const url = `${window.location.origin}${window.location.pathname}#/product/${id}`;
            const shareData = {
                title: product.name,
                text: `Check out ${product.name} on ${STORE_NAME}!`,
                url: url
            };

            if (navigator.share) {
                try { await navigator.share(shareData); } catch(err) { console.log(err); }
            } else {
                try {
                    await navigator.clipboard.writeText(url);
                    alert("Link copied to clipboard!");
                } catch(err) { console.error(err); }
            }
        }

        // --- ACTIONS ---

        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        function toggleCart() {
            const sidebar = document.getElementById('cart-sidebar');
            sidebar.classList.toggle('hidden');
            if (!sidebar.classList.contains('hidden')) {
                renderCart();
            }
        }

        function addToCart(productId) {
            const product = PRODUCTS.find(p => p.id === productId);
            const existing = cart.find(item => item.id === productId);
            
            if (existing) {
                existing.quantity += 1;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            
            updateCartCount();
            toggleCart();
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            renderCart();
            updateCartCount();
        }

        function updateQuantity(productId, delta) {
            const item = cart.find(i => i.id === productId);
            if (item) {
                item.quantity += delta;
                if (item.quantity <= 0) removeFromCart(productId);
                else renderCart();
            }
            updateCartCount();
        }

        function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            const badge = document.getElementById('cart-badge');
            badge.textContent = count;
            if (count > 0) badge.classList.remove('hidden');
            else badge.classList.add('hidden');
        }

        function renderCart() {
            const container = document.getElementById('cart-items');
            const footer = document.getElementById('cart-footer');
            const emptyMsg = document.getElementById('cart-empty-msg');
            const totalEl = document.getElementById('cart-total');

            if (cart.length === 0) {
                container.innerHTML = '';
                footer.classList.add('hidden');
                emptyMsg.classList.remove('hidden');
                return;
            }

            emptyMsg.classList.add('hidden');
            footer.classList.remove('hidden');
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            totalEl.textContent = total;

            container.innerHTML = cart.map(item => `
                <div class="bg-panther-900 p-3 rounded-lg flex gap-3 border border-panther-700">
                    <img src="${item.image}" class="w-20 h-20 object-cover rounded-md bg-gray-800">
                    <div class="flex-1 flex flex-col justify-between">
                        <div>
                            <h4 class="font-semibold text-white line-clamp-1">${item.name}</h4>
                            <p class="text-panther-accent text-sm font-medium">₹${item.price}</p>
                        </div>
                        <div class="flex items-center justify-between mt-2">
                            <div class="flex items-center gap-2 bg-panther-800 rounded px-2 py-1 border border-panther-700">
                                <button onclick="updateQuantity('${item.id}', -1)" class="text-gray-400 hover:text-white px-1">-</button>
                                <span class="text-white text-sm w-4 text-center">${item.quantity}</span>
                                <button onclick="updateQuantity('${item.id}', 1)" class="text-gray-400 hover:text-white px-1">+</button>
                            </div>
                            <button onclick="removeFromCart('${item.id}')" class="text-red-400 hover:text-red-300 p-1">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        // --- CHECKOUT ---
        function openCheckout() {
            toggleCart(); // Close cart
            document.getElementById('checkout-modal').classList.remove('hidden');
            document.body.classList.add('modal-open');
            
            // Calc total
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.querySelectorAll('.checkout-total').forEach(el => el.textContent = total);

            // Generate QR
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi%3A%2F%2Fpay%3Fpa%3D${UPI_ID}%26pn%3DBLACKPANTHER%20Store%26am%3D${total}%26cu%3DINR`;
            document.getElementById('qr-image').src = qrUrl;
        }

        function closeCheckout() {
            document.getElementById('checkout-modal').classList.add('hidden');
            document.getElementById('checkout-success').classList.add('hidden');
            document.getElementById('checkout-form').classList.remove('hidden');
            document.body.classList.remove('modal-open');
        }

        function setPaymentMethod(method) {
            currentPaymentMethod = method;
            const btnCod = document.getElementById('btn-cod');
            const btnOnline = document.getElementById('btn-online');
            const codSection = document.getElementById('payment-cod-section');
            const onlineSection = document.getElementById('payment-online-section');

            if (method === 'cod') {
                btnCod.className = "flex flex-col items-center justify-center p-3 rounded-xl border transition-all bg-panther-accent/10 border-panther-accent text-white";
                btnOnline.className = "flex flex-col items-center justify-center p-3 rounded-xl border transition-all bg-panther-900 border-panther-700 text-gray-400 hover:border-gray-500";
                codSection.classList.remove('hidden');
                onlineSection.classList.add('hidden');
            } else {
                btnOnline.className = "flex flex-col items-center justify-center p-3 rounded-xl border transition-all bg-panther-accent/10 border-panther-accent text-white";
                btnCod.className = "flex flex-col items-center justify-center p-3 rounded-xl border transition-all bg-panther-900 border-panther-700 text-gray-400 hover:border-gray-500";
                codSection.classList.add('hidden');
                onlineSection.classList.remove('hidden');
                onlineSection.classList.add('flex');
            }
        }

        function copyUPI() {
            navigator.clipboard.writeText(UPI_ID);
            alert("UPI ID Copied!");
        }

        async function handlePlaceOrder(e) {
            e.preventDefault();
            const btn = document.getElementById('submit-btn');
            btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Processing...`;
            btn.disabled = true;
            lucide.createIcons();

            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            const fullAddress = `${data.houseNo}, ${data.area}, ${data.locality}, ${data.city}, ${data.state} - ${data.pincode}`;
            const itemsList = cart.map(item => `${item.name} x${item.quantity}`).join(', ');
            const paymentStatus = currentPaymentMethod === 'online' ? 'PAID ONLINE (Verify QR)' : 'Cash on Delivery';

            // WhatsApp Message
            const waMessage = `*🐯 NEW ORDER ALERT - BLACKPANTHER*
--------------------------------
*👤 Customer Details:*
Name: ${data.fullName}
Phone: ${data.phone}
Address: ${fullAddress}

*🛒 Order Summary:*
${cart.map(item => `• ${item.name} (x${item.quantity})`).join('\n')}

*💰 Total Amount:* ₹${total}
*💳 Payment:* ${paymentStatus}
--------------------------------
Please confirm dispatch timeline.`;

            const waLink = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(waMessage)}`;

            // Google Sheets Payload
            const payload = {
                date: new Date().toISOString(),
                customerName: data.fullName,
                phone: data.phone,
                email: "hmoinuddin84@gmail.com",
                address: fullAddress,
                items: itemsList,
                totalAmount: total,
                paymentMethod: paymentStatus,
                status: 'New'
            };

            try {
                if (!GOOGLE_SCRIPT_URL.includes("XXXXXXXX")) {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                }
                
                // Show Success
                cart = [];
                updateCartCount();
                document.getElementById('checkout-form').classList.add('hidden');
                document.getElementById('checkout-success').classList.remove('hidden');
                document.getElementById('wa-link-btn').href = waLink;
                
                // Open WhatsApp
                window.open(waLink, '_blank');

            } catch (err) {
                console.error(err);
                alert("Error connecting. Please check internet.");
            } finally {
                btn.innerHTML = `<i data-lucide="send" class="w-4 h-4"></i> Confirm & Place Order`;
                btn.disabled = false;
                lucide.createIcons();
            }
        }

        // --- AI ASSISTANT ---
        function toggleAI() {
            document.getElementById('ai-window').classList.toggle('hidden');
        }

        async function sendAIMessage() {
            const input = document.getElementById('ai-input');
            const text = input.value.trim();
            if (!text) return;

            const messagesDiv = document.getElementById('ai-messages');
            
            // Add User Message
            messagesDiv.innerHTML += `
                <div class="flex justify-end">
                    <div class="max-w-[80%] p-3 rounded-lg text-sm bg-panther-accent text-white rounded-br-none">${text}</div>
                </div>`;
            
            input.value = '';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            // Add Loading
            const loadingId = 'ai-loading-' + Date.now();
            messagesDiv.innerHTML += `
                <div id="${loadingId}" class="flex justify-start">
                    <div class="bg-panther-700 p-3 rounded-lg rounded-bl-none flex items-center gap-2">
                        <i data-lucide="loader-2" class="w-4 h-4 animate-spin text-panther-accent"></i> <span class="text-gray-400 text-xs">Thinking...</span>
                    </div>
                </div>`;
            lucide.createIcons();

            try {
                // Config API
                const API_KEY = ""; // NOTE: Add API Key here or via ENV for safety in real deploy
                let responseText = "I'm currently offline (API Key missing).";
                
                if (API_KEY) {
                    const ai = new GoogleGenAI({ apiKey: API_KEY });
                    const productContext = PRODUCTS.map(p => `- ${p.name} (${p.category}): ₹${p.price}. ${p.description}`).join('\n');
                    const systemInstruction = `You are 'PantherBot', AI sales assistant for BLACKPANTHER. Catalog:\n${productContext}\nGoal: Help customers. Currency: INR. Keep concise.`;
                    
                    const chat = ai.chats.create({
                        model: 'gemini-2.5-flash',
                        config: { systemInstruction },
                        history: aiHistory
                    });
                    
                    const result = await chat.sendMessage({ message: text });
                    responseText = result.text;
                    aiHistory.push({ role: 'user', parts: [{ text }] });
                    aiHistory.push({ role: 'model', parts: [{ text: responseText }] });
                }

                document.getElementById(loadingId).remove();
                messagesDiv.innerHTML += `
                    <div class="flex justify-start">
                        <div class="max-w-[80%] p-3 rounded-lg text-sm bg-panther-700 text-gray-200 rounded-bl-none">${responseText}</div>
                    </div>`;

            } catch (err) {
                document.getElementById(loadingId).remove();
                messagesDiv.innerHTML += `<div class="text-red-400 text-xs text-center">Error connecting to AI.</div>`;
            }
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

    </script>
</body>
</html>